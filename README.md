# ClusterDE-Application
R code for ClusterDE seminar paper application
# ClusterDE Application on *Bacillus subtilis* Single-cell RNA-seq Data

This repository contains the code and results for my seminar paper application of **ClusterDE** to *Bacillus subtilis* single-cell RNA-seq data.  
The aim is to evaluate how calibration with synthetic null data improves differential expression (DE) analysis compared to a naïve Seurat pipeline.

---

##  Repository Structure
.
├── ClusterDE_Application.R # Main analysis script (all steps integrated)
├── data/ # Input data (not included in repo for size reasons)
│ └── filtered_feature_bc_matrix_Bsub_minimal_media.h5
├── results/ # Output results generated by the script
│ ├── table1_dataset_summary.csv
│ ├── table1_cell_summary.csv
│ ├── table1_gene_summary.csv
│ ├── table1_top10_genes.csv
│ ├── target_DE/
│ │ ├── DE_wilcox_full.csv
│ │ ├── DE_t_full.csv
│ │ ├── DE_poisson_full.csv
│ │ ├── DE_negbinom_full.csv
│ │ ├── DE_LR_full.csv
│ │ ├── table_DE_counts_by_test.csv
│ │ ├── table_top20_wilcox.csv
│ │ └── plot_DE_counts_by_test.png
│ ├── null_data/
│ │ └── synthetic_null_matrix.rds
│ ├── null_umap_comparison_by_resolution.png
│ ├── contrast_diag/
│ │ └── contrast_hist_filtered.png
│ └── marker_viz/
│ └── marker_expression_comparison.png
└── README.md

##  How to Run

### 1. Install dependencies
```r
install.packages(c("Seurat","ggplot2","patchwork","Matrix","hdf5r",
                   "PairedData","MASS","scales","readr","magrittr",
                   "knitr","dplyr"))
# Bioconductor
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("SingleCellExperiment")
# GitHub package (ClusterDE)
remotes::install_github("DongyuanSong/ClusterDE")
2. Place input data
Put the 10X Genomics .h5 file into the data/ folder:
data/filtered_feature_bc_matrix_Bsub_minimal_media.h5
3. Run analysis
source("ClusterDE_Application.R")
All intermediate and final results will be saved automatically into the results/ folder.

Workflow Overview
Data import & overview

Reads the 10X .h5 file

Produces dataset summary tables (table1_*)

Target Seurat pipeline

Normalization, PCA, clustering (resolution = 0.06)

UMAP visualization (umap_target_res006.png)

DE analysis using 5 different tests

Comparison of DE counts (plot_DE_counts_by_test.png)

Synthetic null data

Constructed with ClusterDE::constructNull()

Clustered with Seurat (resolution = 0.06 and 0.075)

UMAP comparison (null_umap_comparison_by_resolution.png)

Contrast calibration

Compare target vs null p-values

Compute contrast scores and calibrated DE genes

Histogram (contrast_hist_filtered.png)

Marker visualization

Compare expression patterns of naïve Seurat vs ClusterDE markers

Combined panel (marker_expression_comparison.png)

Diagnostics

Symmetry of contrast scores tested with Yuen’s trimmed-mean test

Relation to the Paper
Section 4.1–4.2: Dataset overview (Table 1, summary CSVs)

Section 4.3–4.4: Seurat pipeline clustering & DE analysis

Section 4.5–4.6: Null data construction and comparison

Section 4.7: Contrast calibration & FDR control

Section 4.8: Visualization of marker expression

Section 4.9: Diagnostics

The repository ensures full reproducibility of all results reported in the application section of the seminar paper.
